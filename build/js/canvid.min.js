!function(a,b){"undefined"!=typeof module&&module.exports?module.exports=b():"function"==typeof define&&define.amd?define([],b):a.canvid=b()}(this,function(){function a(a){function b(a,b){function c(){e--,0===e&&b(null,d)}var d={},e=Object.keys(a).length;if(0===e)return b("You need to define at least one video object.");for(var f in a)d[f]=new Image,d[f].onload=c,d[f].onerror=b,d[f].src=a[f].src}function c(){var a=document.createElement("canvas");return a.width=m.width,a.height=m.height,a.classList.add("canvid"),n.appendChild(a),a.getContext("2d")}function d(){[].forEach.call(n.children,function(a){a.classList.contains("canvid")||(a.style.display="none")})}function e(){[].forEach.call(n.children,function(a){a.classList.contains("canvid")&&n.removeChild(a)})}function f(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return setTimeout(a,1e3/60)}}function g(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))}function h(a){return"function"==typeof a||!!(a&&a.constructor&&a.call&&a.apply)}function i(){for(var a,b={},c=0;c<arguments.length;c++)for(a in arguments[c])arguments[c].hasOwnProperty(a)&&(b[a]=arguments[c][a]);return b}var j={width:800,height:450,selector:".canvid-wrapper"},k=!0,l={play:function(){console.log("Cannot play before images are loaded")}},m=i(j,a),n="string"==typeof m.selector?document.querySelector(m.selector):m.selector;if(!n)return console.warn("Error. No element found for selector",m.selector);if(!m.videos)return console.warn("Error. You need to define at least one video object");if(g())b(m.videos,function(a,b){if(a)return console.warn("Error while loading video sources.",a);var g=c(),i=f();l.play=function(a,c,f){function j(){u||(n(t),t=+t+(c?-1:1),0>t&&(t+=+p.frames),t>=p.frames&&(t=0),(c?t!=p.frames-1:t)||w++,p.loops&&w>=p.loops&&(v=!1,p.onEnd&&h(p.onEnd)&&p.onEnd())),u=(u+1)%x,v&&p.frames>1&&i(j)}function n(a){var b=Math.floor(a%p.cols)*q,c=Math.floor(a/p.cols)*r;g.clearRect(0,0,m.width,m.height),g.drawImage(o,b,c,q,r,0,0,m.width,m.height)}l.pause&&l.pause();var o=b[a],p=m.videos[a],q=o.width/p.cols,r=o.height/Math.ceil(p.frames/p.cols),s=f||p.fps||15,t=c?p.frames-1:0,u=0,v=!0,w=0,x=60/s;i(j),l.resume=function(){v=!0,i(j)},l.pause=function(){v=!1,i(j)},l.isPlaying=function(){return v},l.destroy=function(){l.pause(),e()},l.getCurrentFrame=function(){return t},l.setCurrentFrame=function(a){return 0>a||a>=p.frames?!1:(l.isPlaying()||n(a),void(t=a))},k&&(k=!1,d())},h(m.loaded)&&m.loaded(l)});else if(opts.srcGif){var o=new Image;o.src=opts.srcGif,n.appendChild(o)}return l}return a});