function isAndroid(){var a=navigator.userAgent.toLowerCase();return/iphone|ipad|ipod/.test(a)?!1:/android/.test(a)?!1:void 0}function go_one(){JT.to(css3d.dotted.el,1,{onRepeat:!1,ease:JT.Linear.None,onUpdate:function(){dotted_z=0>=dotted_z-4*ratio?0:dotted_z-4*ratio,css3d.dotted.position(0,0,dotted_z).updateT()},onEnd:function(){orienter.init()}})}function go_two(){JT.to(css3d.camera.stage.el,1.5,{onRepeat:!1,ease:JT.Linear.None,onUpdate:function(){a-=4*ratio,css3d.camera.position(0,0,a).updateT()},onEnd:function(){$(".page1").hide(),$("#box1").html(" "),$("#box1").remove(),$(".videoCon").show(),"undefined"!=typeof WeixinJSBridge?WeixinJSBridge.invoke("getNetworkType",{},function(a){try{document.querySelectorAll("video")[0].play()}catch(a){}}):document.querySelectorAll("video")[0].play(),JT.kill(css3d.camera.stage.el)}})}function initNext(){css3d.end(),$(".videoCon").remove(),newCss3.start()}function RndNum(a){for(var b="",c=0;a>c;c++)b+=Math.floor(10*Math.random());return b}function selectFileImage(a){var b=a.files[0],c=null;if(b){var d=/^(image\/jpeg|image\/png)$/i;if(!d.test(b.type))return void alert("请选择jpeg、png格式的图片");EXIF.getData(b,function(){EXIF.getAllTags(this),c=EXIF.getTag(this,"Orientation")});var e=new FileReader;e.onload=function(a){var b=new Image;b.src=a.target.result,b.onload=function(){var a=this.naturalWidth,d=this.naturalHeight;this.naturalWidth>this.naturalHeight&&this.naturalWidth>800?(a=800,d=a*this.naturalHeight/this.naturalWidth):this.naturalHeight>this.naturalWidth&&this.naturalHeight>1200&&(d=1200,a=d*this.naturalWidth/this.naturalHeight);var e=document.createElement("canvas"),f=e.getContext("2d");e.width=a,e.height=d,f.drawImage(this,0,0,a,d);var g=null,h=new MegaPixImage(b);h.render(e,{maxWidth:800,maxHeight:1200,quality:.8,orientation:c}),g=e.toDataURL("image/jpeg",.8),$("#img").css("background-image","url("+g+")");var i=(new Date).getTime(),j=i+RndNum(4),k={user:j,img_base64:g.replace(/^data:image\/(png|jpg|jpeg);base64,/,""),setting:"",duang:""};$.ajax({type:"post",url:"http://vip.zjqq.mobi/tool/base64ToImg",data:k,dataType:"json",async:!0,error:function(a){showMyTips("提交失败，请重试")},success:function(a){console.log(a),"ok"==a.status?($("#img").css("background-image","url("+a.path+")"),$(".imgPath").val(a.path),$(".imgPath_thumb").val(a.path),$(".imgPath_thumb_big").val(a.path)):showMyTips(a.msg)}})}},e.readAsDataURL(b)}}function create(){if(!isAndroid()){css3d.n_s=new C3D.Sprite;for(var a=0;2>a;a++){var b=new C3D.Plane;b.size(310*ratio,402*ratio),b.rotation(10*Math.random(),10*Math.random(),100*Math.random()),b.position(100*Math.random()-50,100*-Math.random(),100*-a*ratio),b.material({image:"http://mat1.gtimg.com/zj/yuwanli/dzw1611/four/images/dotted2.png"}),b.update(),b.el.style.backgroundSize="100% 100%",css3d.n_s.addChild(b)}css3d.stage.addChild(css3d.n_s)}}function check_source(){return window.TencentNews?signSource=1:"undefined"!=typeof WeixinJSBridge?signSource=3:navigator.userAgent?signSource=4:signSource=0,signSource}function showMyTips(a){$(".tipsCon .tips p").html(a),$(".tipsCon").fadeIn()}function reg_new(a){if(!$(".imgPath").val())return void showMyTips("请上传一张照片");$("#"+a+"_reg_button").attr("disabled","disabled");var b=reg_host+"sign/submit/"+a,c=check_source();$.ajax({cache:!1,type:"post",url:b,data:$("#"+a+"_reg_form").serialize()+"&data[signsource]="+c+"&callback=reg_success_callback",async:!1,error:function(b){showMyTips("提交失败，请重试"),$("#"+a+"_reg_button").removeAttr("disabled")},success:function(b){return b=JSON.parse(b),"success"==b.result?(showMyTips("提交成功"),void $(".tipsCon .tips .sure").on("tap",function(){$(".tipsCon").fadeOut(),$(".page3").fadeOut()})):(showMyTips(b.result),void $("#"+a+"_reg_button").removeAttr("disabled"))}})}require.config({paths:{zepto:"http://mat1.gtimg.com/zj/yuwanli/dzw1611/four/js/zeptoAll.min",data:"http://mat1.gtimg.com/zj/yuwanli/dzw1611/four/js/data.min",orienter:"http://mat1.gtimg.com/zj/yuwanli/dzw1611/four/js/orienter.min",css3d:"http://mat1.gtimg.com/zj/yuwanli/dzw1611/four/js/css3d.min",jstween:"http://mat1.gtimg.com/zj/yuwanli/dzw1611/four/js/jstween.min",audiojs:"http://mat1.gtimg.com/zj/yuwanli/dzw1608/qixi/js/audiojs/audio.min"},shim:{zepto:{exports:"$"},data:{exports:"d"}}});var ratio=ratioGlobel/100,css3d,newCss3,winWidth=window.innerWidth,winHeight=window.innerHeight,a=400*ratio,b=400*ratio,orienter,canMove=!1,firstFlag=!1;localhostPaht="http://vip.zjqq.mobi";var reg_host=localhostPaht+"/index.php/",bgx=-(374*winHeight/568-winWidth)/2,dotted_z=200*ratio,b=0;require(["zepto","css3d","data","orienter","jstween","audiojs"],function(a){Pace.on("hide",function(b){a(".page1").addClass("active"),a(".wordsCon,.buling").fadeIn(),css3d.init(),css3d.ininStatus(),setTimeout(function(){newCss3.init()},2e3)}),window.makeVideoPlayableInline(document.querySelectorAll("video")[0],!0,!0),document.getElementById("container").addEventListener("touchstart",function(a){a.preventDefault()}),css3d={stage:"",init:function(){var a=this;a.stage=new C3D.Stage,a.stage.size(winWidth,winHeight).update(),a.resize(),a.camera=a.stage.camera,a.camera.position(0,0,400*ratio),a.camera.stage.el.setAttribute("id","camera"),a.camera.update(),a.page1start()},ininStatus:function(){go_one()},page1start:function(){var a=this;document.getElementById("box1").appendChild(a.stage.el),a.skybox=new C3D.Skybox,a.skybox.size(800*ratio).position(0,0,0).update(),a.stage.addChild(a.skybox),a.sprite=new C3D.Sprite,a.dotted=new C3D.Plane,a.dotted.size(316*ratio,402*ratio),a.dotted.material({image:"http://mat1.gtimg.com/zj/yuwanli/dzw1611/four/images/dotted.png"}),a.dotted.position(0,0,200*ratio),a.dotted.el.style.backgroundSize="100% 100%",a.dotted.el.setAttribute("id","dotted"),a.stage.addChild(a.dotted),a.dotted.update(),a.bgPlane=new C3D.Plane,a.bgPlane.size(600*ratio,800*ratio),a.bgPlane.position(0,0,-10*ratio),a.bgPlane.material({image:"http://mat1.gtimg.com/zj/yuwanli/dzw1611/four/images/page1_bg.jpg"}),a.bgPlane.el.style.backgroundSize="100% auto ",a.bgPlane.el.style.backgroundPosition="center",a.bgPlane.el.style.backgroundRepeat="no-repeat",a.bgPlane.update(),a.stage.addChild(a.bgPlane)},end:function(){a(window).unbind("resize")},resize:function(){var b=this;b.stage.size(window.innerWidth,window.innerHeight).update(),a(window).bind("resize",function(){b.resize()})}},newCss3={init:function(){var a=this;a.stage=new C3D.Stage,a.stage.size(winWidth,winHeight).update(),a.conSprite=new C3D.Sprite,a.photoBox=new C3D.Skybox,a.photoBox.size(700*ratio,680*ratio,700*ratio).material({left:{image:"http://mat1.gtimg.com/zj/yuwanli/dzw1611/four/images/photo/b_01.png"},back:{image:"http://mat1.gtimg.com/zj/yuwanli/dzw1611/four/images/photo/b_04.png"},right:{image:"http://mat1.gtimg.com/zj/yuwanli/dzw1611/four/images/photo/b_03.png"},front:{image:"http://mat1.gtimg.com/zj/yuwanli/dzw1611/four/images/photo/b_02.png"}}).update(),a.photoBox.el.setAttribute("id","photoBox"),a.conSprite.el.setAttribute("id","conSprite"),a.conSprite.addChild(a.photoBox),a.stage.addChild(a.conSprite),document.getElementById("box2").appendChild(a.stage.el),isAndroid()||a.conSprite.position(0,0,-1e3*ratio).rotation(90,0,0).update()},start:function(){var b=this;b.startX=0,b.y=0,setTimeout(function(){firstFlag=!0},2e3),isAndroid()||(JT.fromTo(b.conSprite.el,2,{z:-1e3*ratio,rotationX:90},{z:0,rotationX:0,onEnd:function(){a(".tipsBox").show(),setTimeout(function(){a(".tipsBox").fadeOut(),a(".handCon").fadeIn()},1e3)}}),JT.fromTo(b.photoBox.el,2,{rotationY:0},{z:0,rotationY:360}))},moveOut:function(){a(".handCon").hide();var b=this;JT.fromTo(b.conSprite.el,2,{scaleX:1,scaleY:1,scaleZ:1,z:0,rotationX:0},{z:-1e3*ratio,scaleX:0,scaleY:0,scaleZ:0,rotationX:90,onEnd:function(){a(".page2").addClass("in"),a("#box2").remove(),b.end()}}),JT.fromTo(b.photoBox.el,2,{rotationY:b.photoBox.rotationY},{z:0,rotationY:b.photoBox.rotationY+360})},end:function(){a("#box1").html(" ")},resize:function(){var a=this;a.stage.size(window.innerWidth,window.innerHeight).update(),window.onresize=function(){a.resize()}}},a(".num").css("background-image","url("+num_src+")"),a(".bg").css({"background-position-x":bgx+"px"}),a(document).on("touchstart",".page1,.page2,.box1",function(a){a.preventDefault()}),a(".num")[0].addEventListener("webkitAnimationEnd",function(){go_two()}),a(".ready")[0].addEventListener("webkitAnimationEnd",function(){create(),a(".breath").fadeIn(),a(".page1").one("tap",function(){a(".page1").addClass("out"),a(".bottom").fadeIn(),setTimeout(function(){a(".numCon").show()},1e3)})}),orienter=new Orienter;var b=!0,c=0;orienter.orient=function(a){b&&(c=a.g,b=!1),firstFlag&&(initA=a.a,firstFlag=!1);try{newCss3.photoBox.rotation(0,initA-a.a,0).updateT()}catch(a){}.4*a.g<5&&.4*a.g>-5&&(css3d.camera.rotation(0,.4*a.g,0).updateT(),css3d.dotted.position(4*-a.g,0,0).updateT())},audiojs.events.ready(function(){audiojs.create(document.getElementsByTagName("audio")[0],{css:!1,createPlayer:{markup:!1,playPauseClass:"play-pauseZ",scrubberClass:"scrubberZ",progressClass:"progressZ",loaderClass:"loadedZ",timeClass:"timeZ",durationClass:"durationZ",playedClass:"playedZ",errorMessageClass:"error-messageZ",playingClass:"playingZ"}})}),document.querySelectorAll("video")[0].addEventListener("ended",function(){a(".videoCon").remove(),a("#box2").css("opacity","1"),initNext()}),a(document).one("tap",".handCon",function(b){a(document).off("touchmove","#photoBox"),a(document).off("touchstart","#photoBox"),a(document).off("touchend","#photoBox"),orienter.destroy(),newCss3.moveOut()}),a(document).on("tap",".fromCon form i",function(b){a(".page3").fadeOut()}),a(".tipsCon .tips .sure").on("tap",function(){a(".tipsCon").fadeOut()}),a(document).on("tap",".page2",function(){a(".page3").fadeIn()}),a(document).on("tap",".tipsBox",function(){a(".tipsBox").fadeOut(),a(".handCon").fadeIn()})});